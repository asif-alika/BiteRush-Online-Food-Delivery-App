<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Your Cart | BiteRush')"></head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<section class="container my-4">
  <h3 class="mb-3">Your Cart</h3>
  <div th:if="${#lists.isEmpty(cart.items)}" class="alert alert-info">Your cart is empty. <a th:href="@{/menu}">Browse menu</a></div>

  <div th:if="${!#lists.isEmpty(cart.items)}" class="row g-4">
    <div class="col-lg-8">
      <div class="list-group">
        <div class="list-group-item d-flex align-items-center justify-content-between" th:each="ci : ${cart.items}">
          <div>
            <h6 class="mb-1" th:text="${ci.foodItem.name}"></h6>
            <small class="text-muted">₹<span th:text="${#numbers.formatDecimal(ci.foodItem.price,1,'COMMA',2,'POINT')}"></span> each</small>
          </div>
          <div class="d-flex align-items-center gap-2">
            <form th:action="@{'/cart/update/' + ${ci.id}}" method="post" class="d-flex align-items-center gap-2">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <input class="form-control form-control-sm" type="number" name="qty" min="0" th:value="${ci.quantity}" style="width:80px;">
              <button class="btn btn-outline-secondary btn-sm">Update</button>
            </form>
            <form th:action="@{'/cart/remove/' + ${ci.id}}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <button class="btn btn-outline-danger btn-sm">Remove</button>
            </form>
            <div class="fw-semibold">₹<span th:text="${#numbers.formatDecimal(ci.lineTotal,1,'COMMA',2,'POINT')}"></span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card p-3 shadow-sm">
        <h5>Bill Details</h5>
        <div class="d-flex justify-content-between">
          <span>Item Total</span>
          <span>₹<span th:text="${#numbers.formatDecimal(total,1,'COMMA',2,'POINT')}"></span></span>
        </div>
        <hr>
        <div class="d-flex justify-content-between fw-bold">
          <span>Total Payable</span>
          <span>₹<span th:text="${#numbers.formatDecimal(total,1,'COMMA',2,'POINT')}"></span></span>
        </div>
        <a th:href="@{/checkout}" class="btn btn-danger w-100 mt-3">Proceed to Checkout</a>
      </div>
    </div>
  </div>
</section>
</body>
</html>
